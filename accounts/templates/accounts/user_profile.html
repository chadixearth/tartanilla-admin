{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin User Modal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

  <!-- ✅ Admin Button -->
  <button 
    onclick="document.getElementById('adminModal').classList.remove('hidden')" 
    class="bg-[#531B24] hover:bg-[#6d2a34] text-white font-semibold px-6 py-2 rounded-full"
  >
    Admin
  </button>

  <!-- ✅ Modal Overlay -->
  <div 
    id="adminModal" 
    class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center"
  >
    <!-- ✅ Modal Box -->
    <div class="bg-white w-full max-w-4xl rounded-lg shadow-lg overflow-hidden flex relative">

      <!-- Left: Profile Image -->
      <div class="bg-gray-100 flex flex-col items-center justify-center px-8 py-10 border-r border-gray-300 w-1/3">
        <div class="relative">
          <img 
            id="profileImage"
            src="{% static 'images/tartrack_colored.png' %}" 
            alt="Profile" 
            class="w-40 h-40 rounded-full border-4 border-gray-300 object-cover"
          >
          <button 
            type="button"
            onclick="document.getElementById('profilePhotoInput').click()"
            class="absolute bottom-2 right-2 bg-[#531B24] hover:bg-[#6d2a34] text-white rounded-full p-2 shadow-lg"
            title="Change profile photo"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </button>
        </div>
        <input 
          type="file" 
          id="profilePhotoInput" 
          accept="image/*" 
          style="display: none;"
          onchange="handleProfilePhotoUpload(event)"
        >
        <p class="text-sm text-gray-600 mt-2 text-center">Click camera icon to change photo</p>
      </div>

      <!-- Right: User Info -->
      <div class="flex-1 p-10">
        <!-- Close Button -->
        <button 
          onclick="document.getElementById('adminModal').classList.add('hidden')" 
          class="absolute top-4 right-4 text-gray-500 hover:text-red-600 text-xl"
        >
          &times;
        </button>

        <!-- User Details -->
        <form id="profileForm" method="post">
          {% csrf_token %}
          <div class="space-y-4">

            <!-- First Name -->
            <div class="flex items-center bg-gray-300 rounded px-4 py-2 font-medium">
              <span class="w-1/3">First Name :</span>
              <input id="firstNameInput" name="first_name" type="text" value="{{ user.first_name }}" class="w-2/3 bg-transparent outline-none" disabled>
              <button type="button" onclick="toggleEdit('firstNameInput', this)" class="ml-2 text-gray-500 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6" />
                </svg>
              </button>
            </div>

            <!-- Last Name -->
            <div class="flex items-center bg-white rounded px-4 py-2">
              <span class="w-1/3">Last Name :</span>
              <input id="lastNameInput" name="last_name" type="text" value="{{ user.last_name }}" class="w-2/3 bg-transparent outline-none" disabled>
              <button type="button" onclick="toggleEdit('lastNameInput', this)" class="ml-2 text-gray-500 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6" />
                </svg>
              </button>
            </div>

            <!-- Date of Birth -->
            <div class="flex items-center bg-gray-300 rounded px-4 py-2">
              <span class="w-1/3">Date of Birth :</span>
              <input id="dobInput" name="date_of_birth" type="date" value="{{ profile.date_of_birth|date:'Y-m-d' }}" class="w-2/3 bg-transparent outline-none" disabled>
              <button type="button" onclick="toggleEdit('dobInput', this)" class="ml-2 text-gray-500 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6" />
                </svg>
              </button>
            </div>

            <!-- Role -->
            <div class="flex items-center bg-white rounded px-4 py-2">
              <span class="w-1/3">Role :</span>
              <input id="roleInput" name="role" type="text" value="{{ profile.role }}" class="w-2/3 bg-transparent outline-none" disabled>
              <button type="button" onclick="toggleEdit('roleInput', this)" class="ml-2 text-gray-500 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6" />
                </svg>
              </button>
            </div>

            <!-- Email -->
            <div class="flex items-center bg-gray-300 rounded px-4 py-2">
              <span class="w-1/3">Email :</span>
              <input id="emailInput" name="email" type="email" value="{{ user.email }}" class="w-2/3 bg-transparent outline-none" disabled>
              <button type="button" onclick="toggleEdit('emailInput', this)" class="ml-2 text-gray-500 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6" />
                </svg>
              </button>
            </div>

            <!-- Contact Number -->
            <div class="flex items-center bg-white rounded px-4 py-2">
              <span class="w-1/3">Contact Number :</span>
              <input id="contactInput" name="contact_number" type="text" value="{{ profile.contact_number }}" class="w-2/3 bg-transparent outline-none" disabled>
              <button type="button" onclick="toggleEdit('contactInput', this)" class="ml-2 text-gray-500 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6" />
                </svg>
              </button>
            </div>

            <!-- Address -->
            <div class="flex items-center bg-gray-300 rounded px-4 py-2">
              <span class="w-1/3">Address :</span>
              <input id="addressInput" name="address" type="text" value="{{ profile.address }}" class="w-2/3 bg-transparent outline-none" disabled>
              <button type="button" onclick="toggleEdit('addressInput', this)" class="ml-2 text-gray-500 hover:text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6" />
                </svg>
              </button>
            </div>
          </div>
          <!-- Save Button -->
          <div class="mt-6 text-center">
            <button type="submit" class="bg-[#531B24] hover:bg-[#6d2a34] text-white font-semibold px-6 py-2 rounded-full">
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    function toggleEdit(inputId, btn) {
      const input = document.getElementById(inputId);
      if (input.disabled) {
        input.disabled = false;
        input.classList.remove('bg-transparent');
        input.classList.add('bg-white', 'border', 'border-gray-300', 'rounded');
        input.focus();
        btn.classList.add('text-green-600');
      } else {
        input.disabled = true;
        input.classList.remove('bg-white', 'border', 'border-gray-300', 'rounded');
        input.classList.add('bg-transparent');
        btn.classList.remove('text-green-600');
      }
    }
  </script>

  <!-- Photo Upload JavaScript -->
  <script src="{% static 'js/photo-upload.js' %}"></script>
  <script>
    async function handleProfilePhotoUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const profileImage = document.getElementById('profileImage');
      const originalSrc = profileImage.src;
      
      try {
        // Show loading state
        profileImage.style.opacity = '0.5';
        
        // Upload the photo
        const result = await window.photoUploadManager.uploadProfilePhoto(file, 'admin_user');
        
        if (result.success) {
          // Update the image source
          profileImage.src = result.data.url;
          profileImage.style.opacity = '1';
          
          // Show success message
          showNotification('Profile photo updated successfully!', 'success');
        } else {
          // Restore original image
          profileImage.src = originalSrc;
          profileImage.style.opacity = '1';
          
          // Show error message
          showNotification(`Failed to upload photo: ${result.error}`, 'error');
        }
      } catch (error) {
        // Restore original image
        profileImage.src = originalSrc;
        profileImage.style.opacity = '1';
        
        // Show error message
        showNotification(`Upload failed: ${error.message}`, 'error');
      }
      
      // Clear the input
      event.target.value = '';
    }
    
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
        type === 'success' ? 'bg-green-500 text-white' : 
        type === 'error' ? 'bg-red-500 text-white' : 
        'bg-blue-500 text-white'
      }`;
      notification.textContent = message;
      
      // Add to page
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
  </script>
</body>
</html>
